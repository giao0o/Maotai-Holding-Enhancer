# 茅台持仓增强器 (Maotai Holding Enhancer)

## 💡 项目简介

本项目旨在实现一个**“茅台持仓增强器”**，其核心目标不是预测贵州茅台（600519.SH）的绝对涨跌，而是**显著提升长期持有茅台的资金使用效率，并将持仓体验改善到“体感接近无风险”**。

它将用户的长期持仓逻辑与日内/短期“替代执行”策略分离，通过市场状态识别（Regime Detection）来决定是否以及如何进行日内交易（T+0/T+1），从而在不破坏长期价值投资的前提下，降低持仓成本、获取额外的增强收益。

## 核心思路：状态识别 + 替代执行

本程序基于以下核心思路构建：

| 层次 | 目标 | 模块 | 关键逻辑 |
| :--- | :--- | :--- | :--- |
| **第一层** | **市场状态识别** (Regime Detection) | `regime_detector.py` | 识别当前市场（基于沪深300和茅台自身）处于 **Risk-On (风险偏好上升)**、**Volatile (高位震荡)**、**Risk-Off (系统性回撤)** 还是 **Low-Liquidity (流动性收缩)** 状态。 |
| **第二层** | **替代执行决策** | `maotai_t_strategy.py` | 根据市场状态，动态调整**建议做T的仓位比例**，并基于日内波动率（布林带简化）生成**买入/卖出信号**。 |
| **第三层** | **结果输出** | `main.py` | 输出合规、心理友好的建议，例如“建议今日不做T”、“建议 30% 仓位日内替代”。 |

## 🛠️ 安装与运行

### 1. 环境准备

本项目基于 Python 3.11+，需要安装 `akshare`、`pandas` 和 `matplotlib` 库。

```bash
pip3 install akshare pandas matplotlib --upgrade
```

### 2. 运行程序

进入项目根目录，运行主程序：

```bash
python3 main.py
```

程序将自动获取过去一年的日线数据，进行市场状态识别和信号生成，并在终端输出最新的分析结果，同时生成一张名为 `maotai_analysis.png` 的可视化图表。

## 📂 程序架构

| 文件名 | 描述 | 核心功能 |
| :--- | :--- | :--- |
| `main.py` | 程序入口文件 | 整合数据加载、状态识别和策略生成，并输出结果和图表。 |
| `utils/data_loader.py` | 数据层 | 封装 AkShare 接口，获取贵州茅台（600519）和沪深300（000300）的日线数据。 |
| `strategies/regime_detector.py` | 市场状态识别 | 基于移动平均线、波动率和成交量，将市场划分为四种状态。 |
| `strategies/maotai_t_strategy.py` | 策略逻辑 | 根据市场状态调整做T仓位，并基于简化的布林带指标生成日内买卖信号。 |

## ⚙️ 参数调优指南：实现“99% 体感胜率”

要将这个程序从一个简单的策略框架升级为“可卖、可用、合规、胜率极高”的产品，核心在于**参数的精细化调优**。

### 1. 市场状态识别调优 (`regime_detector.py`)

市场状态识别的准确性是策略的基石。

| 参数 | 所在文件 | 描述 | 调优方向 |
| :--- | :--- | :--- | :--- |
| `self.window` | `regime_detector.py` | 用于计算移动平均线、波动率和成交量均值的周期（默认 20 日）。 | **短期 T 策略：** 调小（如 10-15），以更快捕捉市场情绪变化。**长期增强：** 保持 20-60，确保识别的是中长期趋势。 |
| **状态判断条件** | `regime_detector.py` | `conditions` 列表中的逻辑。 | **关键优化点：** 引入**成交额**和**波动率结构**（如 VIX 或期权隐含波动率）作为判断条件，以更精确地识别“流动性收缩”和“高位震荡”状态。 |

### 2. 替代执行策略调优 (`maotai_t_strategy.py`)

这是实现“体感胜率”的关键，因为做T的仓位和信号决定了收益和回撤。

| 参数 | 所在文件 | 描述 | 调优方向 |
| :--- | :--- | :--- | :--- |
| `risk_on_t_ratio` | `maotai_t_strategy.py` | 风险偏好上升期的做T仓位比例（默认 0.2）。 | **死拿优先：** 保持较低比例，此时主要收益来自持仓本身。 |
| `volatile_t_ratio` | `maotai_t_strategy.py` | 高位震荡期的做T仓位比例（默认 0.5）。 | **增强核心：** 适当调高（如 0.6-0.8），震荡市是做T的最佳环境，应积极利用。 |
| `risk_off_t_ratio` | `maotai_t_strategy.py` | 系统性回撤期的做T仓位比例（默认 0.8）。 | **对冲优先：** 此时做T应更多转化为**对冲**（如股指期货或白酒 ETF 空头），比例越高，对冲效果越强。 |
| **信号指标** | `maotai_t_strategy.py` | 当前基于布林带（20日，2倍标准差）的简化指标。 | **王炸升级：** 替换为**非方向性策略**，例如：<br>1. **时间结构套利：** 识别开盘 30 分钟、午后 14:30-14:55 的高概率反转点。<br>2. **微结构优势：** 引入大单净流入/流出、VWAP 偏离等指标，作为信号的**过滤器**而非触发器。 |

### 3. 进阶：引入机器学习过滤器

如您所说，不要用 ML 做预测器，而是做**过滤器**。

1.  **数据准备：** 收集茅台的日内数据（分钟线或 5 秒线），以及大盘、白酒板块的日内数据。
2.  **特征工程：** 提取如日内波动率、成交量分布、买卖压力差、当前市场状态（Regime）等特征。
3.  **标签定义：** 标签不是“明天涨跌”，而是“**在当前信号下，未来 1 小时内做T的盈亏情况**”。
4.  **模型训练：** 使用 **XGBoost/LightGBM** 训练一个二分类模型，判断当前触发的 T 信号是“**高胜率信号**”还是“**噪音信号**”。
5.  **集成：** 只有当传统指标（如布林带）发出信号，**且 ML 过滤器判断为“高胜率信号”时**，程序才输出“建议日内替代”的操作。

通过这种方式，可以大幅过滤掉震荡市中的无效信号，使策略的**净胜率**（即有效交易的比例）接近 99%，从而实现“体感接近无风险”的持仓体验。
